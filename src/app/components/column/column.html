<div class="columns"
     [ngClass]="{
       'coluna-ganho': title.toLowerCase() === 'ganho',
       'coluna-perdido': title.toLowerCase() === 'perdido'
     }">

  <div class="d-flex justify-content-center align-items-center position-relative mb-2">
    <!-- Título com ícones -->
    <h6 *ngIf="!editandoTitulo" class="mb-0">
      <i *ngIf="title.toLowerCase() === 'ganho'" class="bi bi-check-circle-fill text-success me-1"></i>
      <i *ngIf="title.toLowerCase() === 'perdido'" class="bi bi-x-circle-fill text-danger me-1"></i>
      {{ title }}
    </h6>

    <!-- Campo de edição -->
    <div *ngIf="editandoTitulo" class="d-flex align-items-center w-100">
      <input type="text"
             class="form-control form-control-sm me-2"
             [(ngModel)]="novoTitulo"
             (keyup.enter)="confirmarEdicaoTitulo()" />
      <button class="btn btn-sm btn-success me-1" (click)="confirmarEdicaoTitulo()">
        <i class="bi bi-check-lg"></i>
      </button>
      <button class="btn btn-sm btn-secondary" (click)="cancelarEdicaoTitulo()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

    <!-- Ícone de engrenagem (oculto para ganho/perdido) -->
    <div class="dropdown ms-2" *ngIf="!editandoTitulo && !colunaProtegida">
      <button class="btn btn-sm btn-light" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="bi bi-gear"></i>
      </button>
      <ul class="dropdown-menu dropdown-menu-end">
        <li>
          <button class="dropdown-item" (click)="editarTitulo()">Editar</button>
        </li>
        <li>
          <button class="dropdown-item text-danger" (click)="excluirColuna()">Excluir</button>
        </li>
      </ul>
    </div>
  </div>

  <!-- Dropzone ativa apenas se não for 'Ganho' ou 'Perdido' -->
  <ng-container *ngIf="!colunaProtegida; else colunaSomenteLeitura">
    <div cdkDropList
         [cdkDropListData]="cards"
         [cdkDropListConnectedTo]="connectedTo"
         [id]="index.toString()"
         class="dropzone"
         (cdkDropListDropped)="drop($event)">

      <div *ngFor="let card of cards; trackBy: trackById" cdkDrag>
        <app-card
          [card]="card"
          (cardClicked)="onCardClick(card)"
          (editarCard)="onEditarCard(card)"
          (excluirCard)="onExcluirCard(card)"
          (marcarComoPerdido)="onCardPerdido($event)"
          (marcarComoGanho)="onCardGanho($event)">
        </app-card>
      </div>
    </div>
  </ng-container>

  <!-- Coluna protegida: leitura apenas, sem drag -->
  <ng-template #colunaSomenteLeitura>
    <div class="dropzone">
      <div *ngFor="let card of cards; trackBy: trackById">
        <app-card
          [card]="card"
          [colunaTitulo]="title"
          (cardClicked)="onCardClick(card)"
          (editarCard)="onEditarCard(card)"
          (excluirCard)="onExcluirCard(card)"
          (marcarComoPerdido)="onCardPerdido($event)"
          (marcarComoGanho)="onCardGanho($event)">
        </app-card>
      </div>
    </div>
  </ng-template>
</div>
